<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S Pen to Web Prototype</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            margin: 0;
            height: 100vh;
            background-color: #f0f0f0;
        }

        /* --- Left Panel: Main Note --- */
        #note-area {
            flex: 1;
            padding: 20px;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        #main-note {
            width: 100%;
            height: calc(100% - 40px);
            padding: 10px;
            border: 1px solid #ccc;
            resize: none;
            font-size: 16px;
        }

        /* --- Right Panel: Drawing Canvas --- */
        #drawing-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: #e9e9e9;
        }

        #drawing-canvas {
            border: 2px solid #333;
            background-color: white;
            cursor: crosshair;
            touch-action: none; /* Prevents scrolling/zooming while drawing on touch devices */
        }

        .controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background-color: #0056b3;
        }

        #message {
            margin-top: 10px;
            color: green;
        }
    </style>
</head>
<body>

    <div id="note-area">
        <h2>üìù Main Note</h2>
        <p>Type here, or use the panel on the right to insert handwritten text.</p>
        <textarea id="main-note" placeholder="Start typing your notes..."></textarea>
    </div>

    <div id="drawing-panel">
        <h2>‚úçÔ∏è Handwriting Panel (The Big Pan)</h2>
        <canvas id="drawing-canvas"></canvas>

        <div class="controls">
            <button onclick="clearCanvas()">Clear Writing</button>
            <button onclick="insertHandwritingAsImage()">Insert Drawing (Image)</button>
            <span id="message"></span>
        </div>
        <p><small>NOTE: This prototype inserts the drawing as an image. Real conversion requires complex OCR.</small></p>
    </div>

    <script>
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const mainNote = document.getElementById('main-note');
        const message = document.getElementById('message');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // 1. Setup Canvas Size
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth - 40; // Adjust for padding
            canvas.height = canvas.parentElement.clientHeight - 180; // Adjust for header and controls
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // 2. Drawing Setup
        ctx.lineWidth = 4;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.strokeStyle = 'black';

        // 3. Drawing Handlers (Mouse and Touch)
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getCoords(e);
            e.preventDefault(); // Prevent touch events from scrolling/zooming
        }

        function draw(e) {
            if (!isDrawing) return;
            const [x, y] = getCoords(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            [lastX, lastY] = [x, y];
            e.preventDefault();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function getCoords(e) {
            let x, y;
            const rect = canvas.getBoundingClientRect();

            if (e.touches && e.touches.length > 0) {
                // Touch event
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                // Mouse event
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            return [x, y];
        }

        // Event Listeners for drawing
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        // 4. Control Functions
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            message.textContent = 'Canvas cleared.';
        }

        function insertHandwritingAsImage() {
            // Get the data URL of the canvas (the image)
            const dataURL = canvas.toDataURL('image/png');
            
            // In a real application, you'd send this to an OCR API.
            // For this prototype, we'll simulate text insertion by adding a simple indicator.

            // The best way to "insert" into a textarea is to add a marker.
            const timestamp = new Date().toLocaleTimeString();
            const textToInsert = `\n--- [Handwritten Image Inserted at ${timestamp}] ---`;

            mainNote.value += textToInsert;
            message.textContent = 'Drawing marker inserted into note!';
            
            // For a visually richer note (not a textarea), you'd insert an <img> tag.
            
            // Clear the canvas after insertion, mimicking the Samsung app behavior
            clearCanvas();
        }

    </script>
</body>
</html>
